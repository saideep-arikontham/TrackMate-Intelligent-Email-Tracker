<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trackmate - Job Application Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0B1120;
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 2rem 2rem;
        }
        .glass-card {
            background: rgba(23, 33, 56, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-active {
            background-color: #4f46e5 !important;
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.5);
            transform: translateY(-2px);
        }
        /* Custom scrollbar for Kanban */
        .kanban-board-container {
            scroll-snap-type: x mandatory;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: #4f46e5 #1e293b;
        }
        .kanban-board-container::-webkit-scrollbar { height: 8px; }
        .kanban-board-container::-webkit-scrollbar-track { background: #1e293b; border-radius: 10px; }
        .kanban-board-container::-webkit-scrollbar-thumb { background-color: #4f46e5; border-radius: 10px; }
        .kanban-column { scroll-snap-align: start; }
        
        /* Animation Keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="text-slate-200 antialiased">

    <!-- Screen 1: Login Page -->
    <div id="login-screen" class="min-h-screen flex flex-col items-center justify-center p-4 hidden animate-fade-in">
        <div class="text-center w-full max-w-md">
            <svg class="mx-auto h-20 w-20 text-indigo-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 9v.906a2.25 2.25 0 01-1.183 1.981l-6.478 3.488M2.25 9v.906a2.25 2.25 0 001.183 1.981l6.478 3.488m8.868-1.114a2.25 2.25 0 011.183-1.981l-6.478-3.488m-1.183 1.981l-6.478-3.488m14.136 5.666l-6.478 3.488a2.25 2.25 0 01-2.366 0l-6.478-3.488" />
            </svg>
            <h1 class="text-6xl font-extrabold text-white mb-3 tracking-tight">Trackmate</h1>
            <p class="text-lg text-slate-400 mb-10">Your intelligent job application tracker.</p>
            <a href="/auth/google" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 px-8 rounded-xl shadow-lg shadow-indigo-600/30 flex items-center justify-center w-full sm:w-auto sm:mx-auto transition-all duration-300 transform hover:scale-105 hover:shadow-indigo-500/50">
                <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42v-0.083H24v8h11.303c-1.649 4.657-6.08 8-11.303 8-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-0.138-2.65-0.389-3.917z"/><path fill="#FF3D00" d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 16.318 4 9.656 8.337 6.306 14.691z"/><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238C29.211 35.091 26.715 36 24 36c-5.222 0-9.655-3.373-11.274-7.954l-6.571 4.819C9.656 39.663 16.318 44 24 44z"/><path fill="#1976D2" d="M43.611 20.083H42v-0.083H24v8h11.303c-0.792 2.237-2.231 4.166-4.087 5.574l6.19 5.238C44.464 36.333 48 30.825 48 24c0-1.341-0.138-2.65-0.389-3.917z"/></svg>
                Log in with Google
            </a>
        </div>
    </div>

    <!-- Screen 2: Main Application Dashboard -->
    <div id="main-app" class="min-h-screen hidden p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto animate-fade-in">
        <header class="flex justify-between items-center mb-10">
            <h1 class="text-3xl font-bold text-white flex items-center">
                 <svg class="h-8 w-8 text-indigo-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 9v.906a2.25 2.25 0 01-1.183 1.981l-6.478 3.488M2.25 9v.906a2.25 2.25 0 001.183 1.981l6.478 3.488m8.868-1.114a2.25 2.25 0 011.183-1.981l-6.478-3.488m-1.183 1.981l-6.478-3.488m14.136 5.666l-6.478 3.488a2.25 2.25 0 01-2.366 0l-6.478-3.488" /></svg>
                Trackmate
            </h1>
            <a href="/logout" class="bg-slate-700/50 hover:bg-slate-600/80 text-slate-300 font-medium py-2 px-4 rounded-lg transition-colors border border-slate-600">Logout</a>
        </header>

        <!-- Stat Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
            <div class="glass-card p-6 rounded-2xl flex items-center space-x-5">
                <div class="bg-blue-500/20 p-4 rounded-xl"><svg class="w-8 h-8 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg></div>
                <div>
                    <p class="text-slate-400">Unread Messages (24h)</p>
                    <p id="stat-unread" class="text-4xl font-bold text-white">...</p>
                </div>
            </div>
            <div class="glass-card p-6 rounded-2xl flex items-center space-x-5">
                <div class="bg-amber-500/20 p-4 rounded-xl"><svg class="w-8 h-8 text-amber-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg></div>
                <div>
                    <p class="text-slate-400">Requires Attention</p>
                    <p id="stat-attention" class="text-4xl font-bold text-white">...</p>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-8">
            <button id="btn-open-unread" class="action-btn flex-1 bg-slate-800 hover:bg-indigo-600 text-slate-300 hover:text-white font-semibold py-3 px-4 rounded-xl shadow-md transition-all duration-300 transform hover:-translate-y-1">Open All Unread</button>
            <button id="btn-open-attention" class="action-btn flex-1 bg-slate-800 hover:bg-indigo-600 text-slate-300 hover:text-white font-semibold py-3 px-4 rounded-xl shadow-md transition-all duration-300 transform hover:-translate-y-1">Open 'Requires Attention'</button>
            <button id="btn-open-tracker" class="action-btn flex-1 bg-slate-800 hover:bg-indigo-600 text-slate-300 hover:text-white font-semibold py-3 px-4 rounded-xl shadow-md transition-all duration-300 transform hover:-translate-y-1">Open Job Tracker</button>
        </div>

        <!-- Content Display Area -->
        <div id="content-display" class="glass-card rounded-2xl p-4 sm:p-6 min-h-[50vh]">
            <div id="loader" class="hidden flex justify-center items-center h-full"><div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500"></div></div>
            <div id="initial-message" class="flex flex-col justify-center items-center h-full text-slate-400 text-center opacity-70"><svg class="h-16 w-16 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg><p class="text-xl font-medium">Select an option to view your data.</p></div>
            <ul id="email-list" class="space-y-3"></ul>
            <div id="kanban-board" class="hidden">
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 kanban-board-container pb-4">
                    <!-- Applied -->
                    <div class="bg-slate-900/50 rounded-xl p-4 flex flex-col kanban-column flex-shrink-0 w-full"><div class="flex items-center mb-4"><span class="w-3 h-3 rounded-full bg-sky-400 mr-3"></span><h3 class="font-bold text-lg text-slate-200">Applied</h3></div><div class="space-y-3 overflow-y-auto"><div class="glass-card p-4 rounded-lg hover:border-sky-400/50 transition-all border border-transparent"><h4 class="font-semibold text-white">Software Engineer</h4><p class="text-sm text-slate-400">Innovate Inc.</p><p class="text-xs text-slate-500 mt-2">Sep 01, 2025</p></div><div class="glass-card p-4 rounded-lg hover:border-sky-400/50 transition-all border border-transparent"><h4 class="font-semibold text-white">Frontend Developer</h4><p class="text-sm text-slate-400">Creative Solutions</p><p class="text-xs text-slate-500 mt-2">Aug 28, 2025</p></div></div></div>
                    <!-- Interviewing -->
                    <div class="bg-slate-900/50 rounded-xl p-4 flex flex-col kanban-column flex-shrink-0 w-full"><div class="flex items-center mb-4"><span class="w-3 h-3 rounded-full bg-amber-400 mr-3"></span><h3 class="font-bold text-lg text-slate-200">Interviewing</h3></div><div class="space-y-3 overflow-y-auto"><div class="glass-card p-4 rounded-lg hover:border-amber-400/50 transition-all border border-transparent"><h4 class="font-semibold text-white">Product Manager</h4><p class="text-sm text-slate-400">DataDriven Co.</p><p class="text-xs text-slate-500 mt-2">Phone Screen: Sep 05</p></div></div></div>
                    <!-- Offer -->
                    <div class="bg-slate-900/50 rounded-xl p-4 flex flex-col kanban-column flex-shrink-0 w-full"><div class="flex items-center mb-4"><span class="w-3 h-3 rounded-full bg-emerald-400 mr-3"></span><h3 class="font-bold text-lg text-slate-200">Offer</h4></div><div class="space-y-3 overflow-y-auto"><div class="glass-card p-4 rounded-lg hover:border-emerald-400/50 transition-all border border-transparent"><h4 class="font-semibold text-white">DevOps Engineer</h4><p class="text-sm text-slate-400">CloudNet</p><p class="text-xs text-slate-500 mt-2">Offer Received: Sep 02</p></div></div></div>
                    <!-- Rejected -->
                    <div class="bg-slate-900/50 rounded-xl p-4 flex flex-col kanban-column flex-shrink-0 w-full"><div class="flex items-center mb-4"><span class="w-3 h-3 rounded-full bg-rose-400 mr-3"></span><h3 class="font-bold text-lg text-slate-200">Rejected</h4></div><div class="space-y-3 overflow-y-auto"><div class="glass-card p-4 rounded-lg hover:border-rose-400/50 transition-all border border-transparent"><h4 class="font-semibold text-white">Data Scientist</h4><p class="text-sm text-slate-400">AI Ventures</p><p class="text-xs text-slate-500 mt-2">Aug 30, 2025</p></div></div></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginScreen = document.getElementById('login-screen');
            const mainApp = document.getElementById('main-app');
            const actionButtons = document.querySelectorAll('.action-btn');
            const emailList = document.getElementById('email-list');
            const kanbanBoard = document.getElementById('kanban-board');
            const loader = document.getElementById('loader');
            const initialMessage = document.getElementById('initial-message');
            const statUnread = document.getElementById('stat-unread');
            const statAttention = document.getElementById('stat-attention');

            const checkAuth = async () => {
                try {
                    const response = await fetch('/api/auth/status');
                    const data = await response.json();
                    if (data.isAuthenticated) {
                        loginScreen.classList.add('hidden');
                        mainApp.classList.remove('hidden');
                        // Use mock data for stats initially, then fetch real data
                        statUnread.textContent = '12';
                        statAttention.textContent = '3';
                        // You could fetch real stats here if an endpoint exists
                    } else {
                        mainApp.classList.add('hidden');
                        loginScreen.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    mainApp.classList.add('hidden');
                    loginScreen.classList.remove('hidden');
                }
            };
            
            const clearContent = () => {
                emailList.innerHTML = '';
                kanbanBoard.classList.add('hidden');
                initialMessage.classList.add('hidden');
                emailList.classList.add('hidden');
            };
            
            const setActiveButton = (button) => {
                actionButtons.forEach(b => b.classList.remove('btn-active'));
                if(button) button.classList.add('btn-active');
            }

            const fetchAndDisplayEmails = async (query, button) => {
                setActiveButton(button);
                clearContent();
                loader.classList.remove('hidden');

                try {
                    const response = await fetch(`/api/emails?q=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                    
                    const emails = await response.json();
                    if (emails.error) throw new Error(emails.error);

                    emailList.classList.remove('hidden');
                    if (emails.length > 0) {
                        let delay = 0;
                        emails.forEach(email => {
                            const li = document.createElement('li');
                            li.className = 'glass-card p-4 rounded-lg hover:border-indigo-500/50 transition-all border border-transparent cursor-pointer opacity-0 animate-fade-in';
                            li.style.animationDelay = `${delay}ms`;
                            li.innerHTML = `
                                <div class="flex justify-between items-start">
                                    <div class="flex-1 truncate pr-4">
                                        <p class="font-semibold text-white truncate">${email.subject}</p>
                                        <p class="text-sm text-slate-400 truncate">${email.from.replace(/<.*?>/g, '').trim()}</p>
                                    </div>
                                    <p class="text-xs text-slate-500 whitespace-nowrap">${new Date(email.date).toLocaleDateString()}</p>
                                </div>
                            `;
                            emailList.appendChild(li);
                            delay += 50;
                        });
                    } else {
                        initialMessage.classList.remove('hidden');
                        initialMessage.innerHTML = '<p class="text-center text-slate-400">No messages found matching your criteria.</p>';
                    }
                } catch (err) {
                    console.error('Error fetching emails:', err);
                    initialMessage.classList.remove('hidden');
                    initialMessage.innerHTML = `<p class="text-center text-red-400">Error: Could not fetch emails. Your session may be invalid. Please <a href="/logout" class="underline font-semibold">log out</a> and try again.</p>`;
                } finally {
                    loader.classList.add('hidden');
                }
            };

            const showKanban = (button) => {
                setActiveButton(button);
                clearContent();
                kanbanBoard.classList.remove('hidden');
                kanbanBoard.classList.add('animate-fade-in');
            };

            // Event Listeners
            document.getElementById('btn-open-unread').addEventListener('click', (e) => fetchAndDisplayEmails('is:unread in:inbox newer_than:1d', e.currentTarget));
            document.getElementById('btn-open-attention').addEventListener('click', (e) => fetchAndDisplayEmails('is:unread label:Requires-Attention', e.currentTarget));
            document.getElementById('btn-open-tracker').addEventListener('click', (e) => showKanban(e.currentTarget));

            checkAuth();
        });
    </script>
</body>
</html>

